name: GÃ©nÃ©rer le fichier models-index.md

on:
  push:
    branches: [main]

jobs:
  generate-index:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout du dÃ©pÃ´t
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: GÃ©nÃ©rer le fichier models-index.md
        run: |
          echo "# Liste des modÃ¨les STL" > models-index.md
          echo "" >> models-index.md
          
          for dir in */ ; do
            # Exclure .github
            if [ "$dir" != ".github/" ]; then
              # Supprime le slash final
              name="${dir%/}"
              echo "- [${name}](./${name}/README.md)" >> models-index.md
            fi
          done

      - name: VÃ©rifier les modifications
        id: changes
        run: |
          if git diff --quiet models-index.md; then
            echo "Aucun changement Ã  commit."
            echo "changed=false" >> $GITHUB_OUTPUT
          else
            echo "Des changements dÃ©tectÃ©s dans models-index.md"
            echo "changed=true" >> $GITHUB_OUTPUT
          fi

      - name: Commit et push si nÃ©cessaire
        if: steps.changes.outputs.changed == 'true'
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@users.noreply.github.com"
          git add models-index.md
          git commit -m "ðŸ”„ Mise Ã  jour automatique de models-index.md"
          git push